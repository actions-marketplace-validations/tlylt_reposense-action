name: reposense-action
description: 'Deploy your RepoSense Report to GitHub Pages'
branding: 
  icon: 'upload-cloud'
  color: 'blue'

inputs:
  token:
    description: the required GitHub token for gh-pages deployment
    required: true

runs:
  using: "composite"
  steps:
    - name: Checkout source repo
      uses: actions/checkout@v3
      with:
        path: curr-repo
    - uses: actions/setup-python@v3
      with:
        python-version: "3.8"
    - name: Install dependencies
      run: pip install requests
      shell: bash
    - name: Install Java
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    - name: Checkout Reposense scripts
      uses: actions/checkout@v3
      with:
        repository: tlylt/reposense-action
        path: '.'
    - name: Generate report
      run: bash ./run.sh
      shell: bash
    - name: Deploy via gh-pages
      if: ${{ success() }}
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ inputs.token }}
        user_name: github-actions[bot]
        user_email: 41898282+github-actions[bot]@users.noreply.github.com
        publish_dir: ./reposense-report